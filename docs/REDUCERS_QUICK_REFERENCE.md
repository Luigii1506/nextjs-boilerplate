# ‚ö° **REDUCERS - REFERENCIA R√ÅPIDA**

## üéØ **CHEAT SHEET - REDUCERS ESENCIAL**

### **üìä Estructura B√°sica**

```typescript
// üéØ Reducer Function
export function usersOptimisticReducer(
  state: UsersOptimisticState,
  action: UsersOptimisticAction
): UsersOptimisticState {
  switch (action.type) {
    case USERS_ACTIONS.CREATE_USER:
      return { ...state, users: [...state.users, newUser] };
    default:
      return state;
  }
}

// üìä State Interface
export interface UsersOptimisticState {
  users: User[];
  totalUsers: number;
  activeOperations: number;
  stats: { totalActive: number; totalBanned: number; totalAdmins: number };
}

// üé≠ Action Types
export type UsersOptimisticAction =
  | { type: "CREATE_USER"; tempUser: Omit<User, "id">; tempId: string }
  | { type: "UPDATE_USER"; userId: string; updates: Partial<User> }
  | { type: "DELETE_USER"; userId: string };
```

### **üîç Uso en Hooks**

```typescript
const useUsers = () => {
  const [optimisticState, addOptimistic] = useOptimistic(
    createInitialUsersOptimisticState(),
    usersOptimisticReducer
  );

  const createUser = useCallback(
    async (userData) => {
      // ‚ö° Update optimista inmediato
      startTransition(() => {
        addOptimistic({
          type: USERS_ACTIONS.CREATE_USER,
          tempUser: userData,
          tempId: generateTempUserId(),
        });
      });

      // üåê Server action en background
      const result = await createUserServerAction(userData);
      return result;
    },
    [addOptimistic]
  );

  return { users: optimisticState.users, createUser };
};
```

### **üîç Selectors Comunes**

```typescript
// üìä Selectors b√°sicos
const users = usersOptimisticSelectors.getAllUsers(state);
const totalUsers = usersOptimisticSelectors.getTotalUsers(state);
const stats = usersOptimisticSelectors.getStats(state);

// üéØ Selectors de filtrado
const activeUsers = usersOptimisticSelectors.getActiveUsers(state);
const bannedUsers = usersOptimisticSelectors.getBannedUsers(state);
const adminUsers = usersOptimisticSelectors.getAdminUsers(state);

// üîç Selectors de b√∫squeda
const searchResults = usersOptimisticSelectors.searchUsers(state, "term");
const userById = usersOptimisticSelectors.getUserById(state, "user-123");

// üîÑ Selectors de estado
const isLoading = usersOptimisticSelectors.isLoading(state);
const hasErrors = usersOptimisticSelectors.hasErrors(state);
```

---

## üîß **SNIPPETS DE C√ìDIGO R√ÅPIDO**

### **üéØ Crear Reducer Simple**

```typescript
export function moduleOptimisticReducer(
  state: ModuleState,
  action: ModuleAction
): ModuleState {
  switch (action.type) {
    case MODULE_ACTIONS.CREATE_ITEM:
      return {
        ...state,
        items: [...state.items, action.item],
        totalItems: state.totalItems + 1,
        lastUpdated: new Date().toISOString(),
      };

    case MODULE_ACTIONS.UPDATE_ITEM:
      return {
        ...state,
        items: state.items.map((item) =>
          item.id === action.id ? { ...item, ...action.updates } : item
        ),
        lastUpdated: new Date().toISOString(),
      };

    case MODULE_ACTIONS.DELETE_ITEM:
      return {
        ...state,
        items: state.items.filter((item) => item.id !== action.id),
        totalItems: Math.max(0, state.totalItems - 1),
        lastUpdated: new Date().toISOString(),
      };

    default:
      return state;
  }
}
```

### **üìä Estado Inicial**

```typescript
export function createInitialState(): ModuleState {
  return {
    items: [],
    totalItems: 0,
    lastUpdated: new Date().toISOString(),
    activeOperations: 0,
    errors: {},
  };
}
```

### **üîç Selectors B√°sicos**

```typescript
export const selectors = {
  getAllItems: (state) => state.items,
  getTotalItems: (state) => state.totalItems,
  getActiveItems: (state) => state.items.filter((item) => item.active),
  isLoading: (state) => state.activeOperations > 0,
  hasErrors: (state) => Object.keys(state.errors).length > 0,
};
```

### **ü™ù Hook con Reducer**

```typescript
export const useModule = () => {
  const [optimisticState, addOptimistic] = useOptimistic(
    createInitialState(),
    moduleOptimisticReducer
  );

  const createItem = useCallback(
    async (itemData) => {
      const tempId = generateTempId();

      startTransition(() => {
        addOptimistic({
          type: MODULE_ACTIONS.CREATE_ITEM,
          item: { ...itemData, id: tempId },
        });
      });

      const result = await createItemServerAction(itemData);
      return result;
    },
    [addOptimistic]
  );

  return {
    items: optimisticState.items,
    isLoading: selectors.isLoading(optimisticState),
    createItem,
  };
};
```

---

## üéØ **PATRONES COMUNES**

### **üîÑ CRUD Operations**

```typescript
// ‚úÖ CREATE
case ACTIONS.CREATE:
  return {
    ...state,
    items: [...state.items, newItem],
    totalItems: state.totalItems + 1,
  };

// ‚úÖ UPDATE
case ACTIONS.UPDATE:
  return {
    ...state,
    items: state.items.map(item =>
      item.id === action.id ? { ...item, ...action.updates } : item
    ),
  };

// ‚úÖ DELETE
case ACTIONS.DELETE:
  return {
    ...state,
    items: state.items.filter(item => item.id !== action.id),
    totalItems: Math.max(0, state.totalItems - 1),
  };
```

### **üìä Stats Calculation**

```typescript
// üßÆ Helper function para calcular stats
const calculateStats = (items) => ({
  total: items.length,
  active: items.filter(item => item.active).length,
  inactive: items.filter(item => !item.active).length,
});

// üìä Usar en reducer
case ACTIONS.UPDATE_ITEM: {
  const nextItems = updateItemInArray(state.items, action.id, action.updates);
  const nextStats = calculateStats(nextItems);

  return {
    ...state,
    items: nextItems,
    stats: nextStats,
  };
}
```

### **üîÑ Loading States**

```typescript
// üîÑ Manejar loading states
case ACTIONS.START_LOADING:
  return {
    ...state,
    activeOperations: state.activeOperations + 1,
  };

case ACTIONS.COMPLETE_LOADING:
  return {
    ...state,
    activeOperations: Math.max(0, state.activeOperations - 1),
    errors: { ...state.errors, [action.operation]: undefined },
  };

case ACTIONS.FAIL_LOADING:
  return {
    ...state,
    activeOperations: Math.max(0, state.activeOperations - 1),
    errors: { ...state.errors, [action.operation]: action.error },
  };
```

### **üîç Search & Filter**

```typescript
// üîç Selectors para b√∫squeda
const searchSelectors = {
  searchItems: (state, searchTerm) =>
    state.items.filter(
      (item) =>
        item.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
        item.description.toLowerCase().includes(searchTerm.toLowerCase())
    ),

  filterByStatus: (state, status) =>
    state.items.filter((item) => item.status === status),

  getItemsByCategory: (state, category) =>
    state.items.filter((item) => item.category === category),
};
```

---

## üö® **TROUBLESHOOTING R√ÅPIDO**

### **‚ùå Problema: Estado no se actualiza**

```typescript
// ‚ùå MAL: Mutar estado directamente
state.items.push(newItem);
return state;

// ‚úÖ BIEN: Inmutabilidad
return {
  ...state,
  items: [...state.items, newItem],
};
```

### **‚ùå Problema: Re-renders excesivos**

```typescript
// ‚ùå MAL: Selector sin memoizaci√≥n
const activeItems = state.items.filter((item) => item.active);

// ‚úÖ BIEN: Selector memoizado
const activeItems = useMemo(
  () => selectors.getActiveItems(state),
  [state.items]
);
```

### **‚ùå Problema: P√©rdida de datos temporales**

```typescript
// ‚ùå MAL: Reemplazar todo el estado
case ACTIONS.REFRESH_DATA:
  return { ...initialState, items: action.items };

// ‚úÖ BIEN: Preservar datos temporales
case ACTIONS.REFRESH_DATA: {
  const tempItems = state.items.filter(item => item.id.startsWith('temp-'));
  return {
    ...state,
    items: [...action.items, ...tempItems],
    activeOperations: 0,
    errors: {},
  };
}
```

### **‚ùå Problema: Stats desactualizadas**

```typescript
// ‚ùå MAL: No recalcular stats
case ACTIONS.UPDATE_ITEM:
  return {
    ...state,
    items: updatedItems,
    // ‚ùå Stats quedan obsoletas
  };

// ‚úÖ BIEN: Recalcular stats autom√°ticamente
case ACTIONS.UPDATE_ITEM: {
  const nextItems = updateItemInArray(state.items, action.id, action.updates);
  const nextStats = calculateStats(nextItems);

  return {
    ...state,
    items: nextItems,
    stats: nextStats,
  };
}
```

---

## üí° **TIPS DE PERFORMANCE**

### **‚úÖ HACER**

```typescript
// ‚úÖ Memoizar selectors complejos
const expensiveData = useMemo(
  () => selectors.getComplexData(state),
  [state.lastUpdated]
);

// ‚úÖ Usar dependencias espec√≠ficas
const activeItems = useMemo(
  () => selectors.getActiveItems(state),
  [state.items] // Solo recalcular si cambian items
);

// ‚úÖ Helper functions fuera del reducer
const calculateStats = (items) => {
  /* ... */
};

// ‚úÖ Batch updates cuando sea posible
startTransition(() => {
  addOptimistic(action1);
  addOptimistic(action2);
  addOptimistic(action3);
});
```

### **‚ùå EVITAR**

```typescript
// ‚ùå C√°lculos costosos en cada render
const stats = state.items.reduce((acc, item) => {
  /* ... */
}, {});

// ‚ùå Dependencias demasiado amplias
const activeItems = useMemo(
  () => selectors.getActiveItems(state),
  [state] // ‚ùå Se recalcula con cualquier cambio
);

// ‚ùå M√∫ltiples acciones s√≠ncronas separadas
addOptimistic(action1);
addOptimistic(action2); // ‚ùå Causa m√∫ltiples re-renders
addOptimistic(action3);
```

---

## üìö **REFERENCIAS R√ÅPIDAS**

### **üéØ Action Constants Template**

```typescript
export const MODULE_ACTIONS = {
  // CRUD operations
  CREATE_ITEM: "CREATE_ITEM",
  UPDATE_ITEM: "UPDATE_ITEM",
  DELETE_ITEM: "DELETE_ITEM",

  // Bulk operations
  BULK_UPDATE: "BULK_UPDATE",
  BULK_DELETE: "BULK_DELETE",

  // UI operations
  START_LOADING: "START_LOADING",
  COMPLETE_LOADING: "COMPLETE_LOADING",
  FAIL_LOADING: "FAIL_LOADING",
  CLEAR_ERRORS: "CLEAR_ERRORS",

  // Data operations
  REFRESH_DATA: "REFRESH_DATA",
} as const;
```

### **üìä State Interface Template**

```typescript
export interface ModuleOptimisticState {
  // üìä Main data
  items: Item[];
  totalItems: number;

  // ‚è∞ Metadata
  lastUpdated: string;

  // üîÑ UI state
  activeOperations: number;
  errors: Record<string, string>;

  // üìà Analytics
  stats: {
    totalActive: number;
    totalInactive: number;
    // ... m√°s stats seg√∫n necesidad
  };
}
```

### **üîç Selectors Template**

```typescript
export const moduleOptimisticSelectors = {
  // üìä Basic selectors
  getAllItems: (state) => state.items,
  getTotalItems: (state) => state.totalItems,
  getStats: (state) => state.stats,

  // üéØ Filter selectors
  getActiveItems: (state) => state.items.filter((item) => item.active),
  getItemsByType: (state, type) =>
    state.items.filter((item) => item.type === type),

  // üîç Search selectors
  searchItems: (state, term) =>
    state.items.filter((item) =>
      item.name.toLowerCase().includes(term.toLowerCase())
    ),
  getItemById: (state, id) => state.items.find((item) => item.id === id),

  // üîÑ State selectors
  isLoading: (state) => state.activeOperations > 0,
  hasErrors: (state) => Object.keys(state.errors).length > 0,
  getErrors: (state) => state.errors,
};
```

### **‚ö° Helper Functions Template**

```typescript
// üßÆ Calculation helpers
export const calculateStats = (items) => ({
  total: items.length,
  active: items.filter((item) => item.active).length,
  // ... m√°s c√°lculos
});

// üîÑ Array manipulation helpers
export const updateItemInArray = (items, id, updates) =>
  items.map((item) => (item.id === id ? { ...item, ...updates } : item));

export const removeItemFromArray = (items, id) =>
  items.filter((item) => item.id !== id);

// üÜî ID generation helpers
export const generateTempId = () =>
  `temp-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;

export const isTempId = (id) => id.startsWith("temp-");
```

---

## üéØ **EJEMPLOS ONE-LINERS**

```typescript
// üéØ Hook b√°sico
const { items, createItem } = useModule();

// üìä Estado con stats
const { items, stats, isLoading } = useModule();

// üîç Con selectors
const activeItems = moduleSelectors.getActiveItems(optimisticState);

// ‚ö° Acci√≥n optimista
addOptimistic({ type: "CREATE_ITEM", item: newItem });

// üßÆ C√°lculo r√°pido de stats
const stats = calculateStats(state.items);

// üîÑ Update inmutable
const nextItems = updateItemInArray(items, id, updates);

// üÜî ID temporal
const tempId = generateTempId();
```

---

## üìñ **DOCUMENTACI√ìN COMPLETA**

- üìö **[REDUCERS_SYSTEM_COMPLETE_GUIDE.md](./REDUCERS_SYSTEM_COMPLETE_GUIDE.md)** - Gu√≠a completa del sistema
- üîß **[REDUCERS_COMPONENTS_DETAILED.md](./REDUCERS_COMPONENTS_DETAILED.md)** - An√°lisis detallado de componentes
- üí° **[REDUCERS_PRACTICAL_EXAMPLES.md](./REDUCERS_PRACTICAL_EXAMPLES.md)** - Ejemplos pr√°cticos y casos de uso
- üîÑ **[REDUCERS_HOOKS_INTEGRATION.md](./REDUCERS_HOOKS_INTEGRATION.md)** - Integraci√≥n con hooks y useOptimistic

---

**üí´ ¬°Ya tienes todo lo necesario para dominar el sistema de reducers!** üöÄ
