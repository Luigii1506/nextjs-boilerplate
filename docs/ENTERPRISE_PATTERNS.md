# üèÜ ENTERPRISE PATTERNS V2.0 - EST√ÅNDAR AVANZADO DE M√ìDULOS

## üìê ARQUITECTURA ENTERPRISE AVANZADA

### **Estructura de Carpetas (OBLIGATORIA - VERSI√ìN 2.0)**

```
üìÅ modules/[module-name]/
‚îú‚îÄ‚îÄ üìä constants/index.ts           # ‚≠ê NUEVO: Configuraci√≥n centralizada
‚îú‚îÄ‚îÄ ‚öôÔ∏è config/
‚îÇ   ‚îú‚îÄ‚îÄ index.ts                    # ‚≠ê NUEVO: Configuration Manager
‚îÇ   ‚îî‚îÄ‚îÄ legacy.ts                   # ‚≠ê NUEVO: Backward compatibility
‚îú‚îÄ‚îÄ üìù utils/
‚îÇ   ‚îú‚îÄ‚îÄ index.ts                    # Utilities compartidos
‚îÇ   ‚îî‚îÄ‚îÄ logger.ts                   # ‚≠ê NUEVO: Sistema de logging avanzado
‚îú‚îÄ‚îÄ üéØ reducers/index.ts            # ‚≠ê NUEVO: Estado optimista centralizado
‚îú‚îÄ‚îÄ üèÜ hooks/
‚îÇ   ‚îî‚îÄ‚îÄ use[ModuleName].ts          # SINGLE hook per module (ENHANCED)
‚îú‚îÄ‚îÄ üèóÔ∏è server/
‚îÇ   ‚îú‚îÄ‚îÄ actions/index.ts            # Server Actions (Source of Truth)
‚îÇ   ‚îú‚îÄ‚îÄ services/index.ts           # Business Logic Layer
‚îÇ   ‚îú‚îÄ‚îÄ queries/index.ts            # Database queries
‚îÇ   ‚îî‚îÄ‚îÄ mappers/index.ts            # Data transformation
‚îú‚îÄ‚îÄ üß© ui/
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ shared/                 # ‚≠ê NUEVO: Componentes micro reutilizables
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [ComponentName].tsx     # Componentes espec√≠ficos
‚îÇ   ‚îî‚îÄ‚îÄ routes/                     # Pages/screens
‚îú‚îÄ‚îÄ üìù types/index.ts               # TypeScript interfaces
‚îú‚îÄ‚îÄ üìã schemas/index.ts             # Zod validation schemas
‚îú‚îÄ‚îÄ üìÑ index.ts                     # ‚≠ê NUEVO: Barrel exports enterprise
‚îú‚îÄ‚îÄ üìö ENTERPRISE_PATTERNS.md       # Esta documentaci√≥n
‚îî‚îÄ‚îÄ üìä OPTIMIZATION_SUMMARY.md      # ‚≠ê NUEVO: M√©tricas y logros
```

## üéØ PRINCIPIOS EMPRESARIALES V2.0

### **1. Configuration-Driven Architecture**

- **Configuration Manager** centralizado con patr√≥n Singleton
- **Feature flags** para m√≥dulos experimentales/opcionales
- **Core modules** siempre activos (sin feature flags)
- **Environment-specific configs** (dev, prod, high-performance)
- **User overrides** permitidos con merge inteligente

### **2. Structured Logging Excellence**

- **Enterprise Logger** con m√∫ltiples niveles y contexto
- **Performance timing** integrado para m√©tricas
- **Module-specific loggers** con prefijos consistentes
- **Production-safe logging** con configuraci√≥n por ambiente

### **3. Centralized State Management**

- **Optimistic reducers** con estado inmutable
- **Selector patterns** para queries eficientes
- **Action constants** centralizados y tipados
- **State analytics** con m√©tricas detalladas

### **4. Single Source of Truth + Enhanced**

- **Server Actions** como √∫nica fuente de verdad
- **React 19 compliance** con useActionState correcto
- **Automatic cache invalidation** con tags espec√≠ficos
- **Error boundaries** y manejo robusto de errores

### **5. Modular Component Architecture**

- **Shared micro-components** reutilizables
- **Barrel exports** organizados por responsabilidad
- **Legacy compatibility** mantenida autom√°ticamente
- **Performance optimization** con React.memo y useCallback

### **6. Enterprise-Grade Performance**

- **Memoization strategies** aplicadas consistentemente
- **Bundle optimization** con tree-shaking autom√°tico
- **Lazy loading** de componentes pesados
- **Background sync** y refresh inteligente

## üîÄ TIPOS DE M√ìDULOS ENTERPRISE

### **üìä M√≥dulos con Feature Flags (Experimentales/Opcionales)**

**Cu√°ndo usar:**

- ‚úÖ Funcionalidades en desarrollo/testing
- ‚úÖ A/B testing de caracter√≠sticas
- ‚úÖ Funcionalidades que pueden ser deshabilitadas
- ‚úÖ Rollouts graduales de features
- ‚úÖ M√≥dulos que dependen de configuraciones externas

**Caracter√≠sticas:**

- Configuration Manager con feature flags
- Inicializaci√≥n condicional basada en flags
- UI que se adapta seg√∫n flags activos
- Fallbacks cuando features est√°n deshabilitadas

### **üèóÔ∏è M√≥dulos Core (Siempre Activos)**

**Cu√°ndo usar:**

- ‚úÖ Funcionalidades esenciales del sistema
- ‚úÖ M√≥dulos cr√≠ticos para la operaci√≥n
- ‚úÖ Funcionalidades que NUNCA deben ser deshabilitadas
- ‚úÖ Componentes base de la arquitectura

**Caracter√≠sticas:**

- Configuration Manager simplificado (sin feature flags)
- Inicializaci√≥n directa sin verificaciones
- UI siempre disponible
- Configuraci√≥n centrada en performance y UX

---

## üõ†Ô∏è PATRONES DE IMPLEMENTACI√ìN V2.0

### **üìä Constants Pattern (NUEVO)**

#### **üîß Para M√≥dulos con Feature Flags:**

```typescript
// constants/index.ts
export const ENTERPRISE_CONFIG = {
  // üîß Feature flags (m√≥dulo experimental/opcional)
  enableOptimisticUI: true,
  enableAdvancedLogging: process.env.NODE_ENV === "development",
  enableProgressTracking: true,
  enableAutoRefresh: true,

  // ‚ö° Performance settings
  debounceMs: 300,
  maxRetries: 3,
  cacheTimeout: 5 * 60 * 1000, // 5 minutes

  // üïê Timing constants
  uploadProgressDelay: 50,
  clearCompletedDelay: 2000,
  retryDelayMs: 1000,

  // üìä UI Constants
  maxFilesPerBatch: 10,
  maxFileSize: 50 * 1024 * 1024, // 50MB
  progressUpdateInterval: 100,
} as const;
```

#### **üèóÔ∏è Para M√≥dulos Core (Siempre Activos):**

```typescript
// constants/index.ts
export const CORE_CONFIG = {
  // ‚ö° Performance settings (sin feature flags)
  debounceMs: 300,
  maxRetries: 3,
  cacheTimeout: 5 * 60 * 1000, // 5 minutes

  // üïê Timing constants
  refreshDelayMs: 1000,
  retryDelayMs: 1000,

  // üìä UI Constants
  itemsPerPage: 20,
  maxItemSize: 100 * 1024 * 1024, // 100MB
  updateInterval: 200,

  // üîß Core features (siempre habilitadas)
  advancedLogging: process.env.NODE_ENV === "development",
  performanceTracking: true,
} as const;

// Action constants - TIPADOS Y CENTRALIZADOS
export const MODULE_ACTIONS = {
  START_UPLOAD: "START_UPLOAD",
  UPDATE_PROGRESS: "UPDATE_PROGRESS",
  COMPLETE_UPLOAD: "COMPLETE_UPLOAD",
  FAIL_UPLOAD: "FAIL_UPLOAD",
  CLEAR_COMPLETED: "CLEAR_COMPLETED",
} as const;

// Status constants
export const MODULE_STATUS = {
  PENDING: "pending",
  UPLOADING: "uploading",
  COMPLETED: "completed",
  ERROR: "error",
} as const;

// Cache tags para revalidation
export const CACHE_TAGS = {
  DATA: "module-data",
  STATS: "module-stats",
  CATEGORIES: "module-categories",
} as const;

// Logging levels
export const LOG_LEVELS = {
  INFO: "info",
  ERROR: "error",
  DEBUG: "debug",
  WARN: "warn",
} as const;
```

### **üìù Lite Logger Pattern (SIMPLIFICADO - RECOMENDADO)**

> **üéØ ENFOQUE PR√ÅCTICO**: Solo logging cr√≠tico para operaciones importantes

```typescript
// utils/logger.ts
import { ENTERPRISE_CONFIG } from "../constants";

export type LogContext = Record<string, unknown>;

class LiteLogger {
  private module: string;

  constructor(module: string) {
    this.module = module;
  }

  private shouldLog(): boolean {
    return (
      ENTERPRISE_CONFIG.enableAdvancedLogging ||
      process.env.NODE_ENV === "production"
    );
  }

  // ‚ùå ERROR LOGGING (Siempre habilitado)
  error(message: string, error?: unknown, context?: LogContext): void {
    console.error(`‚ùå ${this.module} | ${message}`, {
      timestamp: new Date().toISOString(),
      error:
        error instanceof Error
          ? { name: error.name, message: error.message, stack: error.stack }
          : error,
      ...context,
    });
  }

  // üîê SECURITY LOGGING (Solo operaciones cr√≠ticas)
  security(event: string, context: LogContext): void {
    console.warn(`üîê ${this.module} | SECURITY: ${event}`, {
      timestamp: new Date().toISOString(),
      level: "SECURITY_AUDIT",
      ...context,
    });
  }

  // üë§ OPERATION LOGGING (Solo operaciones cr√≠ticas)
  operation(name: string, success: boolean, details?: LogContext): void {
    const status = success ? "‚úÖ" : "‚ùå";
    console.log(`üéØ ${this.module} | ${name} ${status}`, {
      timestamp: new Date().toISOString(),
      operation: name,
      success,
      ...(details || {}),
    });
  }

  // ‚ÑπÔ∏è INFO LOGGING (Solo en desarrollo)
  info(message: string, context?: LogContext): void {
    if (this.shouldLog()) {
      console.log(`‚ÑπÔ∏è ${this.module} | ${message}`, {
        timestamp: new Date().toISOString(),
        ...context,
      });
    }
  }

  // üîç DEBUG LOGGING (Solo en desarrollo)
  debug(message: string, context?: LogContext): void {
    if (process.env.NODE_ENV === "development") {
      console.debug(`üîç ${this.module} | ${message}`, {
        timestamp: new Date().toISOString(),
        ...context,
      });
    }
  }
}

// üèóÔ∏è Factory function simplificada
export function createLiteLogger(module: string): LiteLogger {
  return new LiteLogger(`[ModuleName] ${module}`);
}

// üéØ Pre-configured loggers (solo los esenciales)
export const moduleLogger = createLiteLogger("Hook");
export const serverActionLogger = createLiteLogger("ServerAction");
export const securityLogger = createLiteLogger("Security");
```

### **üìù Enterprise Logger Pattern (COMPLETO - Para Scale Grande)**

> **üè¢ SOLO para aplicaciones con muchos usuarios o compliance estricto**

<details>
<summary>Ver implementaci√≥n completa (click para expandir)</summary>

```typescript
// utils/logger-enterprise.ts
import { ENTERPRISE_CONFIG, LOG_LEVELS } from "../constants";

export type LogLevel = (typeof LOG_LEVELS)[keyof typeof LOG_LEVELS];
export type LogContext = Record<string, unknown>;

class EnterpriseLogger extends LiteLogger {
  private sessionId: string;

  constructor(module: string) {
    super(module);
    this.sessionId = `session-${Date.now()}-${Math.random()
      .toString(36)
      .substr(2, 9)}`;
  }

  // üéØ Enterprise: Performance timing
  timeStart(label: string): void {
    if (this.shouldLog()) {
      console.time(`‚è±Ô∏è ${this.module} ${label}`);
    }
  }

  timeEnd(label: string): void {
    if (this.shouldLog()) {
      console.timeEnd(`‚è±Ô∏è ${this.module} ${label}`);
    }
  }

  // üìä Enterprise: Analytics tracking
  analytics(event: string, properties: LogContext): void {
    if (process.env.NODE_ENV === "production") {
      console.log(`üìä ${this.module} | ANALYTICS: ${event}`, {
        timestamp: new Date().toISOString(),
        sessionId: this.sessionId,
        ...properties,
      });
    }
  }

  // üéØ Enterprise: Grouped logging
  group(title: string): void {
    if (this.shouldLog()) {
      console.group(`üóÇÔ∏è ${this.module} ${title}`);
    }
  }

  groupEnd(): void {
    if (this.shouldLog()) {
      console.groupEnd();
    }
  }
}
```

</details>

### **ü§î ¬øCu√°l Logger usar?**

#### **üü¢ LITE LOGGER (Recomendado para la mayor√≠a)**

**‚úÖ Usar cuando:**

- Proyectos en MVP o crecimiento temprano
- Equipo peque√±o (1-5 desarrolladores)
- Menos de 10,000 usuarios
- Necesitas debugging b√°sico + seguridad cr√≠tica

**üéØ Incluye solo lo esencial:**

- ‚ùå Error logging (siempre habilitado)
- üîê Security events (operaciones cr√≠ticas)
- üéØ Operation logging (success/failure de acciones importantes)
- ‚ÑπÔ∏è Info logging (solo desarrollo)
- üîç Debug logging (solo desarrollo)

#### **üü° ENTERPRISE LOGGER (Para scale grande)**

**‚úÖ Usar cuando:**

- +50,000 usuarios activos
- Equipo distribuido (+10 desarrolladores)
- Compliance estricto (GDPR, SOX, PCI-DSS)
- Clientes enterprise que requieren auditor√≠a
- Operaciones cr√≠ticas con dinero/pagos

**üéØ Incluye todo del Lite +:**

- ‚è±Ô∏è Performance timing para optimization
- üìä Analytics tracking detallado
- üóÇÔ∏è Grouped logging para debugging complejo
- üìà Business metrics tracking

#### **üî¥ HERRAMIENTAS EXTERNAS (Alternativa simple)**

**‚úÖ Usar cuando:**

- Quieres logging profesional sin c√≥digo custom
- Tienes presupuesto para herramientas ($50-500/mes)
- Equipo peque√±o sin tiempo para implementar

**üõ†Ô∏è Opciones recomendadas:**

- **Sentry** - Error tracking + performance
- **DataDog** - Logging + monitoring
- **LogRocket** - Frontend logging + session replay
- **Mixpanel** - Analytics + user tracking

---

### **‚öôÔ∏è Configuration Manager Pattern (NUEVO)**

#### **üîß Para M√≥dulos con Feature Flags:**

```typescript
// config/index.ts
import { ENTERPRISE_CONFIG } from "../constants";

export interface EnterpriseModuleConfig {
  features: {
    optimisticUI: boolean;
    advancedLogging: boolean;
    progressTracking: boolean;
    autoRefresh: boolean;
  };
  performance: {
    debounceMs: number;
    maxRetries: number;
    cacheTimeout: number;
  };
  ui: {
    maxFilesPerBatch: number;
    maxFileSize: number;
  };
}

export class ModuleConfigManager {
  private static instance: ModuleConfigManager;
  private config: EnterpriseModuleConfig;
  private overrides: Partial<EnterpriseModuleConfig> = {};

  private constructor() {
    this.config = this.deepClone(DEFAULT_CONFIG);
  }

  public static getInstance(): ModuleConfigManager {
    if (!ModuleConfigManager.instance) {
      ModuleConfigManager.instance = new ModuleConfigManager();
    }
    return ModuleConfigManager.instance;
  }

  public getConfig(): EnterpriseModuleConfig {
    return this.mergeConfigs(this.config, this.overrides);
  }

  public setOverrides(overrides: Partial<EnterpriseModuleConfig>): void {
    this.overrides = this.deepClone(overrides);
  }

  // üéØ Para feature flags
  public isFeatureEnabled(
    feature: keyof EnterpriseModuleConfig["features"]
  ): boolean {
    return this.getConfig().features[feature];
  }
}

export const moduleConfig = ModuleConfigManager.getInstance();
```

#### **üèóÔ∏è Para M√≥dulos Core (Siempre Activos):**

```typescript
// config/index.ts
import { CORE_CONFIG } from "../constants";

export interface CoreModuleConfig {
  // Sin secci√≥n de features - todo siempre activo
  performance: {
    debounceMs: number;
    maxRetries: number;
    cacheTimeout: number;
  };
  ui: {
    itemsPerPage: number;
    maxItemSize: number;
  };
  settings: {
    advancedLogging: boolean;
    performanceTracking: boolean;
  };
}

export class CoreConfigManager {
  private static instance: CoreConfigManager;
  private config: CoreModuleConfig;
  private overrides: Partial<CoreModuleConfig> = {};

  private constructor() {
    this.config = this.deepClone(DEFAULT_CORE_CONFIG);
  }

  public static getInstance(): CoreConfigManager {
    if (!CoreConfigManager.instance) {
      CoreConfigManager.instance = new CoreConfigManager();
    }
    return CoreConfigManager.instance;
  }

  public getConfig(): CoreModuleConfig {
    return this.mergeConfigs(this.config, this.overrides);
  }

  public setOverrides(overrides: Partial<CoreModuleConfig>): void {
    this.overrides = this.deepClone(overrides);
  }

  // üèóÔ∏è Para m√≥dulos core - configuraciones siempre disponibles
  public getPerformanceSetting(
    key: keyof CoreModuleConfig["performance"]
  ): number {
    return this.getConfig().performance[key];
  }

  public isSettingEnabled(key: keyof CoreModuleConfig["settings"]): boolean {
    return this.getConfig().settings[key];
  }
}

export const coreConfig = CoreConfigManager.getInstance();
```

### **üéØ Optimistic Reducer Pattern (NUEVO)**

```typescript
// reducers/index.ts
import { MODULE_ACTIONS } from "../constants";
import { optimisticLogger } from "../utils/logger";

export interface OptimisticState {
  items: Item[];
  lastUpdated: string;
  totalActiveItems: number;
}

export type OptimisticAction =
  | {
      type: typeof MODULE_ACTIONS.START_UPLOAD;
      files: File[];
      tempIds: string[];
    }
  | {
      type: typeof MODULE_ACTIONS.UPDATE_PROGRESS;
      tempId: string;
      progress: number;
    }
  | { type: typeof MODULE_ACTIONS.COMPLETE_UPLOAD; tempId: string }
  | { type: typeof MODULE_ACTIONS.CLEAR_COMPLETED };

// üéØ Helper functions
const calculateActiveItems = (items: Item[]): number => {
  return items.filter(
    (item) => item.status === "pending" || item.status === "processing"
  ).length;
};

// üéØ ENTERPRISE REDUCER (immutable, logging integrated)
export function optimisticReducer(
  state: OptimisticState,
  action: OptimisticAction
): OptimisticState {
  optimisticLogger.debug(`Optimistic action: ${action.type}`, {
    currentState: state.items.length,
    activeItems: state.totalActiveItems,
  });

  switch (action.type) {
    case MODULE_ACTIONS.START_UPLOAD: {
      const newItems = action.tempIds.map((tempId, index) => ({
        id: tempId,
        progress: 0,
        status: "pending" as const,
        filename: action.files[index]?.name || `file-${index + 1}`,
      }));

      const nextState = {
        items: [...state.items, ...newItems],
        lastUpdated: new Date().toISOString(),
        totalActiveItems: 0, // Will be recalculated
      };

      nextState.totalActiveItems = calculateActiveItems(nextState.items);

      optimisticLogger.info(`Started ${newItems.length} item(s)`, {
        totalItems: nextState.items.length,
        activeItems: nextState.totalActiveItems,
      });

      return nextState;
    }

    // ... other cases
  }
}

// üéØ Selector functions for derived state
export const optimisticSelectors = {
  getActiveItems: (state: OptimisticState) =>
    state.items.filter(
      (item) => item.status === "pending" || item.status === "processing"
    ),

  getCompletedItems: (state: OptimisticState) =>
    state.items.filter((item) => item.status === "completed"),

  hasActiveItems: (state: OptimisticState) => state.totalActiveItems > 0,

  getOverallProgress: (state: OptimisticState) => {
    if (state.items.length === 0) return 0;

    const totalProgress = state.items.reduce(
      (sum, item) => sum + item.progress,
      0
    );
    return Math.round(totalProgress / state.items.length);
  },
};
```

### **üèÜ Enhanced Hook Pattern (ACTUALIZADO)**

#### **üîß Para M√≥dulos con Feature Flags:**

```typescript
// hooks/useFeatureModuleName.ts
import {
  useActionState,
  useOptimistic,
  useCallback,
  useMemo,
  useRef,
  useTransition,
  useEffect,
} from "react";
import { MODULE_ACTIONS } from "../constants";
import { moduleLogger } from "../utils/logger";
import { moduleConfig, adaptConfigForHook } from "../config";
import {
  optimisticReducer,
  createInitialOptimisticState,
  optimisticSelectors,
} from "../reducers";

export const useFeatureModuleName = (userConfig?: Config): Return => {
  const { user } = useAuth();
  const [isPending, startTransition] = useTransition();
  const hasInitialized = useRef(false);

  // üèóÔ∏è ENTERPRISE: Configuration management with feature flags
  const enterpriseConfig = useMemo(
    () => adaptConfigForHook(userConfig),
    [userConfig]
  );

  // üéØ ENTERPRISE: Structured logging with performance tracking
  moduleLogger.timeStart("Hook Initialization");
  moduleLogger.debug("Hook initialized", {
    hasUserConfig: !!userConfig,
    enterpriseFeatures: moduleConfig.getConfigSummary(),
  });
  moduleLogger.timeEnd("Hook Initialization");

  // üéØ PRIMARY DATA STATE (Server Actions as Source of Truth)
  const [dataState, dataAction, dataPending] = useActionState(
    async (): Promise<ActionResult> => {
      moduleLogger.debug("Fetching data from server");
      return await getDataServerAction();
    },
    null
  );

  // üéØ OPTIMISTIC STATE (UI feedback only) - Enterprise managed
  const [optimisticState, addOptimistic] = useOptimistic(
    createInitialOptimisticState(),
    optimisticReducer
  );

  // üöÄ AUTO-INITIALIZATION (React 19 compliant)
  useEffect(() => {
    if (!hasInitialized.current && user) {
      hasInitialized.current = true;

      moduleLogger.group("Module Initialization");
      moduleLogger.info("Initializing module", {
        userId: user.id,
        configSummary: moduleConfig.getConfigSummary(),
      });

      // Load initial data AFTER render (React 19 compliance)
      startTransition(() => {
        dataAction();
      });

      moduleLogger.groupEnd();
    }
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [user]); // Only depend on user - actions are stable

  // üéØ COMPUTED STATES (Enterprise patterns)
  const isLoading = useMemo(
    () => dataPending || isPending,
    [dataPending, isPending]
  );
  const data = useMemo(
    () => (dataState?.success ? dataState.data : []),
    [dataState]
  );
  const error = useMemo(() => dataState?.error || null, [dataState?.error]);

  // üèÜ ENTERPRISE RETURN INTERFACE (Enhanced with selectors and performance metrics)
  return useMemo(
    () => ({
      // üìä Core Data
      data,
      optimisticState: optimisticState.items,

      // üîÑ Loading States (Enhanced with granular state)
      isLoading,
      isProcessing: optimisticSelectors.hasActiveItems(optimisticState),
      isPending,

      // üéØ Analytics
      activeItems: optimisticSelectors.getActiveItems(optimisticState),
      completedItems: optimisticSelectors.getCompletedItems(optimisticState),
      overallProgress: optimisticSelectors.getOverallProgress(optimisticState),

      // ‚ùå Error States
      error,
      hasError: !!error,

      // üéØ Actions (Performance optimized with feature flags)
      performAction: useCallback(
        async (input) => {
          // üîß Optimistic UI (verificar feature flag)
          if (enterpriseConfig.features.optimisticUI) {
            startTransition(() => {
              addOptimistic({
                type: MODULE_ACTIONS.START_UPLOAD,
                files: input.files,
                tempIds: input.tempIds,
              });
            });
          }

          // Server Action
          const result = await performServerAction(input);

          // üîß Auto-refresh (verificar feature flag)
          if (result.success && enterpriseConfig.features.autoRefresh) {
            startTransition(() => {
              dataAction();
            });
          }

          return result;
        },
        [enterpriseConfig, addOptimistic, dataAction]
      ),

      // üîÑ Refresh Actions
      refresh: useCallback(() => {
        moduleLogger.debug("Manual refresh requested");
        startTransition(() => dataAction());
      }, []),

      // üèóÔ∏è Configuration & Debugging
      config: enterpriseConfig,
      configSummary: moduleConfig.getConfigSummary(),

      // üìä Performance Metrics (Development only)
      ...(process.env.NODE_ENV === "development" && {
        debug: {
          hasInitialized: hasInitialized.current,
          optimisticState,
          enterpriseConfig,
          selectors: optimisticSelectors,
        },
      }),
    }),
    [data, optimisticState, isLoading, isPending, error, enterpriseConfig]
  );
};
```

#### **üèóÔ∏è Para M√≥dulos Core (Siempre Activos):**

```typescript
// hooks/useCoreModuleName.ts
import {
  useActionState,
  useOptimistic,
  useCallback,
  useMemo,
  useRef,
  useTransition,
  useEffect,
} from "react";
import { MODULE_ACTIONS } from "../constants";
import { coreLogger } from "../utils/logger";
import { coreConfig } from "../config";
import {
  optimisticReducer,
  createInitialOptimisticState,
  optimisticSelectors,
} from "../reducers";

export const useCoreModuleName = (userConfig?: CoreConfig): Return => {
  const { user } = useAuth();
  const [isPending, startTransition] = useTransition();
  const hasInitialized = useRef(false);

  // üèóÔ∏è CORE: Configuration management (sin feature flags)
  const coreConfiguration = useMemo(() => coreConfig.getConfig(), [userConfig]);

  // üéØ CORE: Structured logging (siempre habilitado)
  coreLogger.timeStart("Core Hook Initialization");
  coreLogger.debug("Core hook initialized", {
    hasUserConfig: !!userConfig,
    performanceSettings: coreConfiguration.performance,
  });
  coreLogger.timeEnd("Core Hook Initialization");

  // üéØ PRIMARY DATA STATE (Server Actions as Source of Truth)
  const [dataState, dataAction, dataPending] = useActionState(
    async (): Promise<ActionResult> => {
      coreLogger.debug("Fetching core data from server");
      return await getCoreDataServerAction();
    },
    null
  );

  // üéØ OPTIMISTIC STATE (siempre habilitado para m√≥dulos core)
  const [optimisticState, addOptimistic] = useOptimistic(
    createInitialOptimisticState(),
    optimisticReducer
  );

  // üöÄ AUTO-INITIALIZATION (Direct - sin verificaci√≥n de flags)
  useEffect(() => {
    if (!hasInitialized.current && user) {
      hasInitialized.current = true;

      coreLogger.group("Core Module Initialization");
      coreLogger.info("Initializing core module", {
        userId: user.id,
        config: coreConfiguration,
      });

      // Load initial data AFTER render (React 19 compliance)
      startTransition(() => {
        dataAction();
      });

      coreLogger.groupEnd();
    }
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [user]);

  // üéØ COMPUTED STATES (Core patterns)
  const isLoading = useMemo(
    () => dataPending || isPending,
    [dataPending, isPending]
  );
  const data = useMemo(
    () => (dataState?.success ? dataState.data : []),
    [dataState]
  );
  const error = useMemo(() => dataState?.error || null, [dataState?.error]);

  // üèóÔ∏è CORE RETURN INTERFACE (Siempre disponible)
  return useMemo(
    () => ({
      // üìä Core Data
      data,
      optimisticState: optimisticState.items,

      // üîÑ Loading States
      isLoading,
      isProcessing: optimisticSelectors.hasActiveItems(optimisticState),
      isPending,

      // üéØ Analytics (siempre disponibles)
      activeItems: optimisticSelectors.getActiveItems(optimisticState),
      completedItems: optimisticSelectors.getCompletedItems(optimisticState),
      overallProgress: optimisticSelectors.getOverallProgress(optimisticState),

      // ‚ùå Error States
      error,
      hasError: !!error,

      // üéØ Actions (Siempre con Optimistic UI y Auto-refresh)
      performAction: useCallback(
        async (input) => {
          // ‚úÖ Optimistic UI (siempre habilitado)
          startTransition(() => {
            addOptimistic({
              type: MODULE_ACTIONS.START_UPLOAD,
              files: input.files,
              tempIds: input.tempIds,
            });
          });

          // Server Action
          const result = await performServerAction(input);

          // ‚úÖ Auto-refresh (siempre habilitado)
          if (result.success) {
            startTransition(() => {
              dataAction();
            });
          }

          return result;
        },
        [addOptimistic, dataAction]
      ),

      // üîÑ Refresh Actions
      refresh: useCallback(() => {
        coreLogger.debug("Manual refresh requested");
        startTransition(() => dataAction());
      }, []),

      // üèóÔ∏è Configuration & Debugging
      config: coreConfiguration,

      // üìä Performance Metrics (Development only)
      ...(coreConfiguration.settings.performanceTracking && {
        debug: {
          hasInitialized: hasInitialized.current,
          optimisticState,
          coreConfiguration,
          selectors: optimisticSelectors,
        },
      }),
    }),
    [data, optimisticState, isLoading, isPending, error, coreConfiguration]
  );
};
```

### **üèóÔ∏è Server Actions Pattern (ENHANCED)**

```typescript
// server/actions/index.ts
import { serverActionLogger } from "../../utils/logger";
import { CACHE_TAGS } from "../../constants";

export async function performActionServerAction(
  formData: FormData
): Promise<ActionResult> {
  const requestId = `req-${Date.now()}-${Math.random()
    .toString(36)
    .substr(2, 9)}`;

  serverActionLogger.timeStart(`Action ${requestId}`);
  serverActionLogger.info("Server action started", { requestId });

  try {
    // 1. Authentication & Authorization
    const session = await auth.api.getSession({ headers: await headers() });
    if (!session?.user) {
      serverActionLogger.error("Unauthorized access attempt", null, {
        requestId,
      });
      return { success: false, error: "No autorizado" };
    }

    // 2. Validation (Zod schemas)
    const validated = parseInputSchema(Object.fromEntries(formData));
    serverActionLogger.debug("Input validated", {
      requestId,
      inputKeys: Object.keys(validated),
    });

    // 3. Business Logic (Service layer)
    const result = await moduleService.performAction(validated);
    serverActionLogger.info("Business logic completed", {
      requestId,
      resultType: typeof result,
    });

    // 4. Cache Invalidation (with logging)
    revalidateTag(CACHE_TAGS.DATA);
    revalidatePath("/module");
    serverActionLogger.debug("Cache invalidated", {
      requestId,
      tags: [CACHE_TAGS.DATA],
    });

    serverActionLogger.timeEnd(`Action ${requestId}`);
    return { success: true, data: result };
  } catch (error) {
    serverActionLogger.error("Server action failed", error, { requestId });
    serverActionLogger.timeEnd(`Action ${requestId}`);
    return {
      success: false,
      error: error instanceof Error ? error.message : "Unknown error",
    };
  }
}
```

### **üìÑ Barrel Exports Pattern (NUEVO)**

```typescript
// index.ts - Enterprise exports organizados
// üéØ Core Hooks (Enterprise Enhanced)
export { useModuleName } from "./hooks/useModuleName";

// üìù Types & Interfaces
export * from "./types";

// üèóÔ∏è Enterprise Configuration System
export {
  type EnterpriseModuleConfig,
  ModuleConfigManager,
  moduleConfig,
  adaptConfigForHook,
  configUtils,
} from "./config";

// üìä Enterprise Constants
export {
  ENTERPRISE_CONFIG,
  MODULE_ACTIONS,
  MODULE_STATUS,
  CACHE_TAGS,
  LOG_LEVELS,
} from "./constants";

// üìù Enterprise Logging System
export {
  createLogger,
  moduleLogger,
  serverActionLogger,
  optimisticLogger,
} from "./utils/logger";

// üîÑ State Management (Optimistic Updates)
export {
  optimisticReducer,
  createInitialOptimisticState,
  optimisticSelectors,
} from "./reducers";

// üéØ Server Layer
export * from "./server";

// üß© UI Components (Enterprise Ready)
export * from "./ui";

// üîß Utilities
export * from "./utils";
```

### **üß© Shared Components Pattern (NUEVO)**

```typescript
// ui/components/shared/FileIcon.tsx
import React from "react";
import { getFileIcon } from "../../../utils";

interface FileIconProps {
  filename: string;
  className?: string;
  size?: "sm" | "md" | "lg";
}

export const FileIcon = React.memo<FileIconProps>(
  ({ filename, className, size = "md" }) => {
    const icon = getFileIcon(filename);
    const sizeClasses = {
      sm: "w-4 h-4",
      md: "w-6 h-6",
      lg: "w-8 h-8",
    };

    return React.cloneElement(
      icon as React.ReactElement<{ className?: string }>,
      {
        className: `${sizeClasses[size]} ${className || ""}`.trim(),
      }
    );
  }
);

FileIcon.displayName = "FileIcon";

// ui/components/shared/FileSize.tsx
export const FileSize = React.memo<{ size: number; className?: string }>(
  ({ size, className }) => (
    <span className={className}>{formatFileSize(size)}</span>
  )
);

// ui/components/shared/ProgressBar.tsx
export const ProgressBar = React.memo<{
  progress: number;
  className?: string;
  showPercentage?: boolean;
}>(({ progress, className, showPercentage = true }) => (
  <div className={`w-full bg-gray-200 rounded-full h-2 ${className}`}>
    <div
      className="bg-blue-600 h-2 rounded-full transition-all duration-300"
      style={{ width: `${Math.min(progress, 100)}%` }}
    />
    {showPercentage && (
      <span className="text-xs text-gray-600 ml-2">{progress}%</span>
    )}
  </div>
));

// ui/components/shared/index.ts
export { FileIcon } from "./FileIcon";
export { FileSize } from "./FileSize";
export { ProgressBar } from "./ProgressBar";
```

## üîß ERROR HANDLING STANDARDS V2.0

### **Enhanced Result Pattern**

```typescript
// types/index.ts
interface ActionResult<T = unknown> {
  success: boolean;
  data?: T;
  error?: string;
  timestamp: string;
  requestId?: string; // Para tracking
  metadata?: Record<string, unknown>; // Para contexto adicional
}

interface ErrorDetails {
  code: string;
  message: string;
  field?: string; // Para errores de validaci√≥n
  context?: Record<string, unknown>;
}

interface EnhancedActionResult<T = unknown> extends ActionResult<T> {
  errors?: ErrorDetails[]; // Para m√∫ltiples errores
  warnings?: string[]; // Para advertencias no cr√≠ticas
}
```

### **Error Categories (ACTUALIZADO)**

- **AUTH_ERROR**: Usuario no autenticado/autorizado
- **VALIDATION_ERROR**: Datos inv√°lidos (con field espec√≠fico)
- **BUSINESS_ERROR**: Reglas de negocio violadas
- **NETWORK_ERROR**: Problemas de conectividad
- **SYSTEM_ERROR**: Errores de infraestructura
- **RATE_LIMIT_ERROR**: L√≠mites de API excedidos
- **CONFIGURATION_ERROR**: Problemas de configuraci√≥n

### **Error Boundary Pattern**

```typescript
// ui/components/ErrorBoundary.tsx
export class ModuleErrorBoundary extends React.Component<
  React.PropsWithChildren<{ fallback?: React.ComponentType<any> }>,
  { hasError: boolean; error?: Error }
> {
  constructor(props: any) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error: Error) {
    moduleLogger.error("Module error boundary triggered", error);
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    moduleLogger.error("Detailed error info", error, { errorInfo });
  }

  render() {
    if (this.state.hasError) {
      const Fallback = this.props.fallback || DefaultErrorFallback;
      return <Fallback error={this.state.error} />;
    }

    return this.props.children;
  }
}
```

## üöÄ PERFORMANCE PATTERNS V2.0

### **React Optimization Standards**

```typescript
// Performance-optimized component pattern
export const OptimizedComponent = React.memo<ComponentProps>(
  ({ data, onAction, config }) => {
    // Memoized calculations
    const processedData = useMemo(
      () => data.map((item) => processItem(item, config)),
      [data, config]
    );

    // Memoized callbacks
    const handleAction = useCallback(
      (id: string) => {
        onAction(id);
      },
      [onAction]
    );

    // Memoized sub-components
    const ItemComponent = useMemo(
      () =>
        React.memo<ItemProps>(({ item, onItemAction }) => (
          <div onClick={() => onItemAction(item.id)}>{item.name}</div>
        )),
      []
    );

    return (
      <div>
        {processedData.map((item) => (
          <ItemComponent
            key={item.id}
            item={item}
            onItemAction={handleAction}
          />
        ))}
      </div>
    );
  },
  // Custom comparison function
  (prevProps, nextProps) => {
    return (
      prevProps.data.length === nextProps.data.length &&
      prevProps.config.version === nextProps.config.version
    );
  }
);
```

### **Loading States (ENHANCED)**

- **Skeleton loading**: Para perceived performance
- **Progressive loading**: Cargar datos por partes
- **Background refresh**: Actualizar sin bloquear UI
- **Optimistic loading**: Mostrar cambios inmediatamente
- **Error recovery**: Retry autom√°tico con backoff

### **Bundle Optimization**

```typescript
// Lazy loading pattern
const HeavyComponent = React.lazy(() =>
  import("./HeavyComponent").then((module) => ({
    default: module.HeavyComponent,
  }))
);

// Code splitting con dynamic imports
const loadFeature = async () => {
  const { feature } = await import("./feature");
  return feature;
};
```

## üß™ TESTING STANDARDS V2.0

### **Hook Testing Pattern**

```typescript
// __tests__/useModuleName.test.ts
import { renderHook, act } from "@testing-library/react";
import { useModuleName } from "../hooks/useModuleName";

describe("useModuleName", () => {
  it("should initialize with correct default state", () => {
    const { result } = renderHook(() => useModuleName());

    expect(result.current.data).toEqual([]);
    expect(result.current.isLoading).toBe(false);
    expect(result.current.error).toBe(null);
  });

  it("should handle optimistic updates correctly", async () => {
    const { result } = renderHook(() => useModuleName());

    await act(async () => {
      await result.current.performAction({ files: [mockFile] });
    });

    expect(result.current.activeItems).toHaveLength(1);
  });
});
```

### **Component Testing with MSW**

```typescript
// __tests__/Component.test.tsx
import { render, screen, fireEvent } from "@testing-library/react";
import { rest } from "msw";
import { setupServer } from "msw/node";
import { Component } from "../Component";

const server = setupServer(
  rest.post("/api/module", (req, res, ctx) => {
    return res(ctx.json({ success: true, data: mockData }));
  })
);

beforeAll(() => server.listen());
afterEach(() => server.resetHandlers());
afterAll(() => server.close());
```

## üö¶ GU√çA DE DECISI√ìN: ¬øQU√â TIPO DE M√ìDULO CREAR?

### **üîç Matriz de Decisi√≥n**

| Caracter√≠stica del M√≥dulo           | **Feature Flags** üîß | **Core** üèóÔ∏è |
| ----------------------------------- | -------------------- | ----------- |
| **Funcionalidad experimental**      | ‚úÖ                   | ‚ùå          |
| **A/B Testing requerido**           | ‚úÖ                   | ‚ùå          |
| **Puede ser deshabilitado**         | ‚úÖ                   | ‚ùå          |
| **Rollout gradual necesario**       | ‚úÖ                   | ‚ùå          |
| **Funcionalidad cr√≠tica**           | ‚ùå                   | ‚úÖ          |
| **Siempre debe estar disponible**   | ‚ùå                   | ‚úÖ          |
| **Parte de la arquitectura base**   | ‚ùå                   | ‚úÖ          |
| **Dependencias externas variables** | ‚úÖ                   | ‚ùå          |
| **Configuraci√≥n compleja**          | ‚úÖ                   | ‚ùå          |

### **üìä Ejemplos Pr√°cticos por Tipo**

#### **üîß M√≥dulos con Feature Flags:**

- **file-upload**: Subida de archivos (puede tener diferentes providers)
- **ai-chat**: Chat con IA (experimental, puede ser costoso)
- **social-sharing**: Compartir en redes sociales (opcional)
- **advanced-analytics**: Analytics avanzados (puede ser premium)
- **video-calling**: Videollamadas (feature beta)
- **dark-mode**: Modo oscuro (preference del usuario)

#### **üèóÔ∏è M√≥dulos Core:**

- **auth**: Autenticaci√≥n (cr√≠tico para seguridad)
- **users**: Gesti√≥n de usuarios (esencial)
- **notifications**: Sistema de notificaciones (core UX)
- **search**: B√∫squeda principal (funcionalidad base)
- **navigation**: Navegaci√≥n del sitio (siempre necesaria)
- **error-handling**: Manejo de errores (infraestructura)

### **üéØ Proceso de Decisi√≥n**

```
¬øEs una funcionalidad cr√≠tica que NUNCA debe fallar?
‚îú‚îÄ S√ç ‚Üí ¬øEs parte de la infraestructura base?
‚îÇ  ‚îú‚îÄ S√ç ‚Üí üèóÔ∏è M√ìDULO CORE
‚îÇ  ‚îî‚îÄ NO ‚Üí Revisar si realmente es cr√≠tica
‚îî‚îÄ NO ‚Üí ¬øNecesita ser habilitada/deshabilitada din√°micamente?
   ‚îú‚îÄ S√ç ‚Üí üîß M√ìDULO CON FEATURE FLAGS
   ‚îî‚îÄ NO ‚Üí ¬øPodr√≠a necesitarlo en el futuro?
      ‚îú‚îÄ S√ç ‚Üí üîß M√ìDULO CON FEATURE FLAGS
      ‚îî‚îÄ NO ‚Üí üèóÔ∏è M√ìDULO CORE
```

### **‚ö° Ventajas y Desventajas**

#### **üîß M√≥dulos con Feature Flags**

**‚úÖ Ventajas:**

- Flexibilidad total para habilitar/deshabilitar
- Ideal para experimentaci√≥n y A/B testing
- Rollouts graduales seguros
- Configuraci√≥n granular por usuario/ambiente
- F√°cil rollback en caso de problemas

**‚ùå Desventajas:**

- C√≥digo m√°s complejo (verificaciones de flags)
- Overhead de configuraci√≥n
- Posibles ramas de c√≥digo muertas
- M√°s superficie de testing

#### **üèóÔ∏è M√≥dulos Core**

**‚úÖ Ventajas:**

- C√≥digo m√°s simple y directo
- Performance ligeramente mejor
- Menos complejidad de testing
- Garant√≠a de disponibilidad

**‚ùå Desventajas:**

- Menos flexibilidad
- Cambios requieren deploys
- No hay rollback granular
- Dif√≠cil hacer A/B testing

---

## üìö MIGRATION CHECKLIST V2.0

Para migrar un m√≥dulo existente al est√°ndar empresarial:

### **1. Decisi√≥n de Arquitectura**

- [ ] **üö¶ Determinar tipo de m√≥dulo** usando la matriz de decisi√≥n
- [ ] **üîß Feature Flags** si es experimental/opcional/configurable
- [ ] **üèóÔ∏è Core Module** si es cr√≠tico/esencial/infraestructura

### **2. Arquitectura Base**

- [ ] **üìä Constants centralizados** en `/constants/index.ts`
  - [ ] Para Feature Flags: Incluir `ENTERPRISE_CONFIG` con feature flags
  - [ ] Para Core: Incluir `CORE_CONFIG` sin feature flags
- [ ] **‚öôÔ∏è Configuration Manager** con patr√≥n Singleton
  - [ ] Para Feature Flags: `ModuleConfigManager` con `isFeatureEnabled()`
  - [ ] Para Core: `CoreConfigManager` con configuraciones directas
- [ ] **üìù Sistema de logging** con EnterpriseLogger
- [ ] **üéØ Reducers optimistas** con selectors
- [ ] **üß© Shared components** micro-reutilizables

### **3. Hook Enterprise**

- [ ] **üèÜ Un solo hook** por m√≥dulo con configuraci√≥n avanzada
  - [ ] Para Feature Flags: `useFeatureModuleName` con verificaciones de flags
  - [ ] Para Core: `useCoreModuleName` con funcionalidades siempre activas
- [ ] **React 19 compliance** con useActionState correcto
- [ ] **Performance optimization** con memoizaci√≥n
- [ ] **Estado unificado** con analytics integradas
- [ ] **Conditional logic** seg√∫n tipo de m√≥dulo:
  - [ ] Feature Flags: `if (config.features.featureName)` antes de acciones
  - [ ] Core: Ejecuci√≥n directa sin verificaciones

### **4. Server Layer**

- [ ] **üèóÔ∏è Server Actions** como √∫nica fuente de verdad
- [ ] **Logging estructurado** en todas las acciones
- [ ] **Cache invalidation** autom√°tica con tags
- [ ] **Error handling** robusto con categor√≠as
- [ ] **Feature validation** seg√∫n tipo:
  - [ ] Feature Flags: Verificar flags en server actions si aplica
  - [ ] Core: Funcionalidad siempre disponible

### **5. UI Layer**

- [ ] **üìÑ Barrel exports** organizados por responsabilidad
- [ ] **üé® Componentes optimizados** con React.memo
- [ ] **Error boundaries** para manejo de errores
- [ ] **Lazy loading** para componentes pesados
- [ ] **Conditional rendering** seg√∫n tipo:
  - [ ] Feature Flags: `{isFeatureEnabled && <FeatureComponent />}`
  - [ ] Core: Renderizado directo sin condiciones

### **6. Quality Assurance**

- [ ] **TypeScript strict** mode habilitado
- [ ] **ESLint** configurado con reglas enterprise
- [ ] **Tests unitarios** para hooks y componentes
- [ ] **Tests E2E** para flujos cr√≠ticos
- [ ] **Feature flag testing**:
  - [ ] Tests con flags habilitados/deshabilitados (si aplica)
  - [ ] Tests de fallbacks y estados por defecto
- [ ] **üìä Documentaci√≥n** actualizada (ENTERPRISE_PATTERNS.md)

---

## üéØ IMPLEMENTACI√ìN PR√ÅCTICA

### **Orden de Implementaci√≥n Recomendado**

#### **üö¶ Paso 0: Decisi√≥n de Arquitectura**

- Usar la matriz de decisi√≥n para determinar el tipo de m√≥dulo
- **Feature Flags** üîß para experimentales/opcionales
- **Core** üèóÔ∏è para cr√≠ticos/esenciales

#### **üìä Fase 1: Foundation**

**Para M√≥dulos con Feature Flags:**

- Crear `/constants/index.ts` con `ENTERPRISE_CONFIG` (incluir feature flags)
- Implementar `/utils/logger.ts` con EnterpriseLogger
- Configurar `/config/index.ts` con `ModuleConfigManager` + `isFeatureEnabled()`

**Para M√≥dulos Core:**

- Crear `/constants/index.ts` con `CORE_CONFIG` (sin feature flags)
- Implementar `/utils/logger.ts` con EnterpriseLogger
- Configurar `/config/index.ts` con `CoreConfigManager` (configuraciones directas)

#### **üîÑ Fase 2: State Management**

- Crear `/reducers/index.ts` con optimistic state (igual para ambos tipos)
- Implementar selectors para queries eficientes
- Configurar action types centralizados

#### **üèÜ Fase 3: Hook Enhancement**

**Para M√≥dulos con Feature Flags:**

- Hook `useFeatureModuleName` con verificaciones de flags
- L√≥gica condicional: `if (config.features.featureName)`
- React 19 compliance con `useActionState`

**Para M√≥dulos Core:**

- Hook `useCoreModuleName` sin verificaciones
- Funcionalidades siempre activas
- React 19 compliance con `useActionState`

#### **üé® Fase 4: UI Optimization**

- Crear shared components reutilizables
- Implementar React.memo y useCallback
- Configurar lazy loading
- **Feature Flags**: Conditional rendering `{isEnabled && <Component />}`
- **Core**: Renderizado directo

#### **üèóÔ∏è Fase 5: Server Integration**

- Enhancear Server Actions con logging (igual para ambos)
- Implementar error handling robusto
- Configurar cache invalidation
- **Feature Flags**: Verificar flags en server si aplica

#### **‚úÖ Fase 6: Quality & Documentation**

- Tests unitarios y E2E
- **Feature Flags**: Tests con flags on/off + fallbacks
- **Core**: Tests de funcionalidad siempre disponible
- Documentaci√≥n enterprise actualizada

---

## üèÜ ENTERPRISE EXCELLENCE ACHIEVED

**Este template representa el est√°ndar M√ÅS ALTO de desarrollo de m√≥dulos empresariales:**

‚úÖ **Arquitectura dual** (Feature Flags + Core) escalable y flexible
‚úÖ **Performance optimizado** con m√©tricas para ambos tipos
‚úÖ **Logging estructurado** para debugging avanzado
‚úÖ **Configuraci√≥n extensible** por ambiente y tipo de m√≥dulo
‚úÖ **Estado predecible** con analytics integradas
‚úÖ **React 19 compliance** total en ambas variantes
‚úÖ **TypeScript strict** mode con tipos espec√≠ficos
‚úÖ **Testing comprehensivo** incluyendo feature flags
‚úÖ **Documentaci√≥n completa** con gu√≠as de decisi√≥n
‚úÖ **Flexibilidad total** para cualquier tipo de funcionalidad

### **üîß Para M√≥dulos con Feature Flags:**

- Ideal para features experimentales, A/B testing, rollouts graduales
- Configuraci√≥n granular y control total sobre habilitaci√≥n/deshabilitaci√≥n
- Perfect para m√≥dulos como `file-upload`, `ai-chat`, `social-sharing`

### **üèóÔ∏è Para M√≥dulos Core:**

- Perfecto para funcionalidades cr√≠ticas y de infraestructura
- C√≥digo m√°s simple y directo, performance optimizado
- Ideal para m√≥dulos como `auth`, `users`, `notifications`

**üöÄ √ösalo como base para TODOS los m√≥dulos futuros, eligiendo el tipo seg√∫n tus necesidades.**

---

## üÜï SERVER ACTIONS ENTERPRISE PATTERN V2.0 (NUEVO)

> **‚≠ê PATR√ìN OFICIAL**: Refactorizaci√≥n completada en `file-upload` (2025-01-18)

### **üéØ PATR√ìN OBLIGATORIO PARA TODOS LOS M√ìDULOS**

Todos los nuevos m√≥dulos y refactorizaciones DEBEN seguir este patr√≥n:

#### **üìÅ Estructura Requerida**

- `/server/validators/[module].validators.ts` - ‚úÖ Validadores centralizados
- `/constants/index.ts` - ‚úÖ Cache tags y paths centralizados
- `/server/actions/index.ts` - ‚úÖ Actions limpias (40-60 l√≠neas m√°ximo)

#### **‚úÖ REGLAS OBLIGATORIAS (4 Pasos)**

1. **üõ°Ô∏è Session validation** - Usar `getValidatedSession()` centralizado
2. **üîç Input validation** - Usar schemas de Zod SIEMPRE
3. **üè¢ Business logic** - Delegar a service layer
4. **üîÑ Cache invalidation** - Usar tags/paths centralizados

#### **üîê LOGGING ESTRAT√âGICO (No Excesivo)**

- **Security audit** para operaciones cr√≠ticas (create, delete)
- **Info logging** para √©xito de operaciones importantes
- **Error logging** para TODOS los fallos
- **RequestId** para tracking de operaciones cr√≠ticas

#### **‚ùå ANTIPATRONES PROHIBIDOS**

- ‚ùå Auth checks inline repetitivos
- ‚ùå Manual FormData parsing
- ‚ùå Console.log debug embebido
- ‚ùå Hard-coded cache tags
- ‚ùå Funciones > 60 l√≠neas
- ‚ùå UUID validation repetida

### **üìö M√ìDULOS DE REFERENCIA**

#### **‚úÖ PATRONES CORRECTOS (Seguir)**

- **`users`** - Patr√≥n original limpio y enterprise
- **`file-upload`** - Refactorizado siguiendo patr√≥n (2025-01-18)

#### **üîß PR√ìXIMOS M√ìDULOS**

Todos los nuevos m√≥dulos DEBEN implementar:

1. Validators centralizados (`getValidatedSession`, `validateModuleAccess`, `validateUUID`)
2. Cache tags organizados (`MODULE_CACHE_TAGS`, `MODULE_PATHS`)
3. Server actions compactas y enfocadas
4. Logging estrat√©gico con security audit trails

### **üèÜ BENEFICIOS COMPROBADOS**

‚úÖ **C√≥digo 40% m√°s corto** que el patr√≥n anterior  
‚úÖ **Mejor mantenibilidad** con validators centralizados  
‚úÖ **Mayor seguridad** con audit trails estructurados  
‚úÖ **Performance mejorado** con cache invalidation optimizada  
‚úÖ **Debugging simplificado** con requestId tracking  
‚úÖ **Testing m√°s f√°cil** con responsabilidades separadas

**üéØ SIGUIENTE ACCI√ìN**: Aplicar este patr√≥n a todos los m√≥dulos nuevos y refactorizar m√≥dulos existentes gradualmente.
