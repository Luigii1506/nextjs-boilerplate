# üéì Gu√≠a Completa de Testing para Principiantes

> **Todo lo que necesitas saber para implementar testing en tu aplicaci√≥n Next.js**

## üìö Tabla de Contenidos

1. [¬øQu√© es Testing?](#-qu√©-es-testing)
2. [Tipos de Testing](#-tipos-de-testing)
3. [Herramientas que Usamos](#-herramientas-que-usamos)
4. [Estructura de Archivos](#-estructura-de-archivos)
5. [Tu Primer Test](#-tu-primer-test)
6. [Tests por Tipo](#-tests-por-tipo)
7. [Agregar Tests a M√≥dulos](#-agregar-tests-a-m√≥dulos)
8. [Ejemplos Pr√°cticos](#-ejemplos-pr√°cticos)
9. [Troubleshooting](#-troubleshooting)

---

## ü§î ¬øQu√© es Testing?

### **üìù Definici√≥n Simple**

**Testing** es escribir c√≥digo que **verifica que tu c√≥digo funciona correctamente**. Es como tener un **asistente autom√°tico** que revisa que todo funcione como esperas.

### **üéØ ¬øPor Qu√© Hacer Testing?**

```javascript
// ‚ùå Sin tests - No sabes si algo se rompi√≥
function sumar(a, b) {
  return a + b; // ¬øFunciona? ¬øQu√© pasa si env√≠o strings?
}

// ‚úÖ Con tests - Tienes certeza de que funciona
test("should add two numbers correctly", () => {
  expect(sumar(2, 3)).toBe(5); // ‚úì Funciona con n√∫meros
  expect(sumar(-1, 1)).toBe(0); // ‚úì Funciona con negativos
  expect(sumar(0, 0)).toBe(0); // ‚úì Funciona con ceros
});
```

### **üöÄ Beneficios del Testing**

- **üõ°Ô∏è Confianza** - Sabes que tu c√≥digo funciona
- **üîÑ Refactoring seguro** - Puedes cambiar c√≥digo sin miedo
- **üêõ Detectar bugs** antes de que lleguen a producci√≥n
- **üìñ Documentaci√≥n** - Los tests muestran c√≥mo usar tu c√≥digo
- **‚ö° Desarrollo m√°s r√°pido** - Menos tiempo debuggeando

---

## üéØ Tipos de Testing

### **1. üß™ Unit Tests (Tests Unitarios)**

**Qu√© son:** Prueban **una funci√≥n o componente** por separado.

```javascript
// üéØ Testing de una funci√≥n
function formatPrice(price) {
  return `$${price.toFixed(2)}`;
}

// Test unitario
test("should format price correctly", () => {
  expect(formatPrice(10)).toBe("$10.00");
  expect(formatPrice(9.99)).toBe("$9.99");
});
```

### **2. üîó Integration Tests (Tests de Integraci√≥n)**

**Qu√© son:** Prueban que **varios componentes trabajen juntos**.

```javascript
// üéØ Testing de un componente con hooks y API
function UserProfile({ userId }) {
  const user = useUser(userId); // Hook que llama API

  if (!user) return <div>Loading...</div>;
  return <div>{user.name}</div>;
}

// Test de integraci√≥n
test("should display user name after loading", async () => {
  render(<UserProfile userId="123" />);
  expect(screen.getByText("Loading...")).toBeInTheDocument();

  await waitFor(() => {
    expect(screen.getByText("John Doe")).toBeInTheDocument();
  });
});
```

### **3. üé≠ E2E Tests (Tests End-to-End)**

**Qu√© son:** Prueban **flujos completos de usuario** en el navegador real.

```javascript
// üéØ Testing de un flujo completo de login
test("user can login and see dashboard", async ({ page }) => {
  // 1. Ir a la p√°gina de login
  await page.goto("/login");

  // 2. Llenar el formulario
  await page.fill("#email", "user@example.com");
  await page.fill("#password", "password123");

  // 3. Hacer click en login
  await page.click("#login-button");

  // 4. Verificar que lleg√≥ al dashboard
  await expect(page).toHaveURL("/dashboard");
  await expect(page.getByText("Welcome!")).toBeVisible();
});
```

---

## üõ†Ô∏è Herramientas que Usamos

### **üß™ Jest** - Test Runner

**Qu√© hace:** Ejecuta tus tests y te dice si pasan o fallan.

```javascript
// Jest provee estas funciones globales:
describe("Calculator", () => {
  // Agrupa tests relacionados
  test("should add numbers", () => {
    // Define un test individual
    expect(2 + 2).toBe(4); // Verifica el resultado
  });
});
```

### **üé≠ React Testing Library** - Testing de Componentes

**Qu√© hace:** Te ayuda a probar componentes React como lo har√≠a un usuario.

```javascript
import { render, screen } from "@testing-library/react";

// Renderiza un componente y lo pone en un DOM virtual
render(<Button>Click me</Button>);

// Busca elementos como lo har√≠a un usuario
const button = screen.getByText("Click me");
expect(button).toBeInTheDocument();
```

### **üé™ Playwright** - Testing E2E

**Qu√© hace:** Controla un navegador real y simula acciones de usuario.

```javascript
// Playwright controla Chrome, Firefox, Safari
await page.goto("https://tu-app.com");
await page.click("button");
await page.fill("input", "texto");
```

---

## üìÅ Estructura de Archivos

### **üóÇÔ∏è D√≥nde Poner Cada Tipo de Test**

```
<code_block_to_apply_changes_from>
```

### **üìã Reglas de Naming**

```
‚úÖ Correcto:
- Button.test.tsx          # Unit test
- UserAuth.integration.test.ts  # Integration test
- login-flow.spec.ts       # E2E test

‚ùå Incorrecto:
- buttontest.tsx
- test-button.tsx
- Button.js                # Usar .test.tsx/.test.ts
```

---

## üèÉ‚Äç‚ôÇÔ∏è Tu Primer Test

### **Paso 1: Crear un Componente Simple**

```typescript
// üéØ Testing de un flujo completo de login
test("user can login and see dashboard", async ({ page }) => {
  // 1. Ir a la p√°gina de login
  await page.goto("/login");

  // 2. Llenar el formulario
  await page.fill("#email", "user@example.com");
  await page.fill("#password", "password123");

  // 3. Hacer click en login
  await page.click("#login-button");

  // 4. Verificar que lleg√≥ al dashboard
  await expect(page).toHaveURL("/dashboard");
  await expect(page.getByText("Welcome!")).toBeVisible();
});
```

## üîó Integration Tests - Template

```typescript
// src/components/__tests__/MyComponent.test.tsx
import React from "react";
import { renderWithProviders } from "@/shared/testing";
import { MyComponent } from "../MyComponent";

describe("MyComponent", () => {
  test("should render correctly", () => {
    const { getByTestId } = renderWithProviders(<MyComponent prop="value" />);

    expect(getByTestId("my-component")).toBeTruthy();
  });

  test("should handle user interactions", () => {
    const mockCallback = jest.fn();
    const { getByTestId } = renderWithProviders(
      <MyComponent onClick={mockCallback} />
    );

    getByTestId("button").click();
    expect(mockCallback).toHaveBeenCalledTimes(1);
  });

  test("should handle async operations", async () => {
    const { getByTestId } = renderWithProviders(<AsyncComponent />);

    expect(getByTestId("loading")).toBeTruthy();

    await new Promise((resolve) => setTimeout(resolve, 100));

    expect(getByTestId("loaded-content")).toBeTruthy();
  });
});
```

## üé≠ E2E Tests - Template

```typescript
// e2e/tests/user-flow.spec.ts
import { test, expect } from "@playwright/test";

describe("User Flow", () => {
  test("user can complete main workflow", async ({ page }) => {
    // 1. Navegar
    await page.goto("/login");

    // 2. Interactuar
    await page.fill('[data-testid="email"]', "user@example.com");
    await page.fill('[data-testid="password"]', "password123");
    await page.click('[data-testid="login-button"]');

    // 3. Verificar resultado
    await expect(page).toHaveURL("/dashboard");
    await expect(page.getByTestId("welcome")).toBeVisible();
  });
});
```

## üîç Buscar Elementos

### **React Testing Library**

```typescript
// Por data-testid (RECOMENDADO)
getByTestId("my-button");
queryByTestId("maybe-missing"); // Retorna null si no existe

// Por texto visible
getByText("Click me");
getByText(/Click/i); // Regex case-insensitive

// Por rol accesible
getByRole("button");
getByRole("button", { name: "Submit" });

// Por placeholder
getByPlaceholderText("Enter email");

// Por etiqueta
getByLabelText("Email address");
```

### **Playwright**

```typescript
// Por data-testid
page.getByTestId("my-button");
page.locator('[data-testid="my-button"]');

// Por texto
page.getByText("Click me");
page.getByRole("button", { name: "Submit" });

// Por selector CSS
page.locator(".my-class");
page.locator("#my-id");
```

## ‚úÖ Verificaciones (Expect)

### **Jest B√°sico**

```typescript
// Igualdad
expect(value).toBe(expected); // Igualdad exacta
expect(value).toEqual(expected); // Igualdad profunda
expect(value).not.toBe(unexpected); // No igual

// Truthiness
expect(value).toBeTruthy();
expect(value).toBeFalsy();
expect(value).toBeNull();
expect(value).toBeUndefined();

// N√∫meros
expect(number).toBeGreaterThan(5);
expect(number).toBeLessThanOrEqual(10);
expect(number).toBeCloseTo(9.999, 2);

// Strings
expect(string).toContain("substring");
expect(string).toMatch(/regex/);
expect(string).toHaveLength(5);

// Arrays
expect(array).toHaveLength(3);
expect(array).toContain("item");
expect(array).toEqual(["a", "b", "c"]);

// Functions
expect(mockFn).toHaveBeenCalled();
expect(mockFn).toHaveBeenCalledTimes(2);
expect(mockFn).toHaveBeenCalledWith("arg1", "arg2");

// Errors
expect(() => dangerousFunction()).toThrow();
expect(() => dangerousFunction()).toThrow("specific error");
```

### **DOM Elements**

```typescript
// Existencia
expect(element).toBeTruthy(); // Elemento existe
expect(element).toBeFalsy(); // Elemento no existe

// Contenido
expect(element.textContent).toBe("Expected text");
expect(element.textContent).toContain("partial");

// Atributos
expect(element.getAttribute("href")).toBe("/link");
expect((element as HTMLInputElement).value).toBe("input value");
expect((element as HTMLButtonElement).disabled).toBe(true);

// CSS Classes
expect(element.className).toContain("active");
expect(element.classList.contains("active")).toBe(true);
```

### **Playwright**

```typescript
// Visibilidad
await expect(page.getByTestId("element")).toBeVisible();
await expect(page.getByTestId("element")).toBeHidden();

// Contenido
await expect(page.getByTestId("element")).toHaveText("Expected");
await expect(page.getByTestId("element")).toContainText("partial");

// Estados
await expect(page.getByTestId("button")).toBeEnabled();
await expect(page.getByTestId("button")).toBeDisabled();
await expect(page.getByTestId("input")).toBeFocused();

// URLs
await expect(page).toHaveURL("/expected-path");
await expect(page).toHaveTitle(/Expected Title/);

// Conteo
await expect(page.getByTestId("item")).toHaveCount(5);
```

## üé™ Mocks y Testing Utilities

### **Jest Mocks**

```typescript
// Funci√≥n mock
const mockFn = jest.fn();
const mockFn = jest.fn().mockReturnValue("default");
const mockFn = jest.fn().mockResolvedValue("async result");

// Mock m√≥dulo completo
jest.mock("../module", () => ({
  myFunction: jest.fn().mockReturnValue("mocked"),
}));

// Mock espec√≠fico
jest.spyOn(module, "functionName").mockImplementation(() => "mocked");
```

### **Shared Testing Utilities**

```typescript
import {
  renderWithProviders,
  renderWithUser,
  renderAsGuest,
  createMockUser,
  testUsers,
  testFeatureFlags,
} from "@/shared/testing";

// Renderizar con providers
const { getByTestId } = renderWithProviders(<Component />);

// Renderizar con usuario mock
const { getByTestId } = renderWithUser(<Component />);

// Usar datos de prueba
const user = testUsers.admin;
const flags = testFeatureFlags.allEnabled;
```

## üéØ Convenciones de Naming

### **Tests**

```typescript
// ‚úÖ Descriptivo y claro
describe("UserProfile Component", () => {
  test("should display user name and email", () => {});
  test("should show edit form when edit button clicked", () => {});
  test("should save changes when form submitted", () => {});
});

// ‚ùå Vago y confuso
describe("UserProfile", () => {
  test("should work", () => {});
  test("should render", () => {});
});
```

### **Data Test IDs**

```typescript
// ‚úÖ Espec√≠fico y √∫nico
<button data-testid="submit-login-form">Login</button>
<div data-testid="user-profile-card">...</div>
<span data-testid="error-message-email">Invalid email</span>

// ‚ùå Gen√©rico y ambiguo
<button data-testid="button">Login</button>
<div data-testid="card">...</div>
<span data-testid="error">Invalid email</span>
```

## üö® Errores Comunes

| Error                                         | Soluci√≥n                                           |
| --------------------------------------------- | -------------------------------------------------- |
| `Cannot find module '@/shared/testing'`       | Verificar que `src/shared/testing/index.ts` existe |
| `Property 'toBeInTheDocument' does not exist` | Usar `expect(element).toBeTruthy()`                |
| `Cannot read properties of null`              | Verificar que elemento existe antes de interactuar |
| `Test timeout`                                | Agregar `await` para operaciones as√≠ncronas        |
| `act() warning`                               | Usar `user-event` o envolver en `act()`            |

## üìä Coverage Goals

```bash
# Objetivos de cobertura
Lines: 80%+         # L√≠neas de c√≥digo ejecutadas
Functions: 85%+     # Funciones ejecutadas
Branches: 75%+      # Ramas (if/else) ejecutadas
Statements: 80%+    # Statements ejecutados

# Ver coverage
npm run test:coverage
open coverage/lcov-report/index.html
```

## üé® Patrones √ötiles

### **AAA Pattern**

```typescript
test("should calculate total price", () => {
  // üîß Arrange - Preparar datos
  const items = [{ price: 10 }, { price: 20 }];

  // üé¨ Act - Ejecutar funci√≥n
  const total = calculateTotal(items);

  // ‚úÖ Assert - Verificar resultado
  expect(total).toBe(30);
});
```

### **Data-Driven Tests**

```typescript
describe("formatPrice", () => {
  const testCases = [
    { input: 10, expected: "$10.00" },
    { input: 9.99, expected: "$9.99" },
    { input: 0, expected: "$0.00" },
  ];

  testCases.forEach(({ input, expected }) => {
    test(`should format ${input} as ${expected}`, () => {
      expect(formatPrice(input)).toBe(expected);
    });
  });
});
```

### **Setup/Teardown**

```typescript
describe("DatabaseService", () => {
  let service;

  beforeEach(() => {
    service = new DatabaseService();
    service.connect();
  });

  afterEach(() => {
    service.disconnect();
    jest.clearAllMocks();
  });

  test("should save data", () => {
    // Test logic
  });
});
```

---

## üéâ ¬°Listo para Testing!

**üí° Recuerda:**

- Empieza con tests simples
- Usa `data-testid` para elementos
- Un test = una verificaci√≥n espec√≠fica
- Tests legibles > Tests cleveres
- Coverage alto ‚â† Tests buenos

**üéâ Happy Testing!**

üìÇ Tu Proyecto
‚îú‚îÄ‚îÄ üìÅ src/
‚îÇ ‚îú‚îÄ‚îÄ üìÅ core/
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ üìÅ components/
‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ Button.tsx
‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ üìÅ **tests**/
‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ Button.test.tsx # ‚úÖ Unit test del componente
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ üìÅ auth/
‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ hooks.ts
‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ üìÅ **tests**/
‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ hooks.test.ts # ‚úÖ Unit test de hooks
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ üìÅ admin/
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ üìÅ **tests**/
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ AdminLayout.test.tsx # ‚úÖ Integration test
‚îÇ ‚îú‚îÄ‚îÄ üìÅ modules/
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ üìÅ file-upload/
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ components/
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ üìÅ **tests**/
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ FileUploader.test.tsx # ‚úÖ Module tests
‚îÇ ‚îî‚îÄ‚îÄ üìÅ shared/
‚îÇ ‚îú‚îÄ‚îÄ üìÅ utils/
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ helpers.ts
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ üìÅ **tests**/
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ helpers.test.ts # ‚úÖ Utility tests
‚îÇ ‚îî‚îÄ‚îÄ üìÅ testing/ # ‚úÖ Testing utilities
‚îú‚îÄ‚îÄ üìÅ **tests**/ # ‚úÖ Global test setup
‚îî‚îÄ‚îÄ üìÅ e2e/ # ‚úÖ E2E tests
‚îî‚îÄ‚îÄ üìÅ tests/
‚îú‚îÄ‚îÄ auth.spec.ts # ‚úÖ E2E: Login flow
‚îú‚îÄ‚îÄ dashboard.spec.ts # ‚úÖ E2E: Dashboard
‚îî‚îÄ‚îÄ file-upload.spec.ts # ‚úÖ E2E: File upload
